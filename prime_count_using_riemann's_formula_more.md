# 黎曼素数计数公式与莫比乌斯展开

#### (1). π(x) 的莫比乌斯展开

对 π(x), 本来就有下面的莫比乌斯展开成立：

$$\begin{cases}
\pi(x) &= Σ_{n=1}^\infty \frac {\mu(n)} n J(x^{1/n})\\
J(x) &= Σ_{n=1}^\infty \frac {π(x^{1/n})} n
\end{cases}$$

因为 $\pi(x^{\frac 1 n})$ 是小于 $x^{\frac 1 n}$ 的素数，所以 $x^{\frac 1 n} < 2$ 后, $\pi(x^{\frac 1 n}) = 0$，从而上面求和其实只有有限项。且 $\frac {\mu(n)} n J(x^{\frac 1 n})$ 逐项很快衰减, 比如 $\pi(10e8)$

|n| $\frac {\mu(n)} n J(x^{\frac 1 n})$ | 截止n: $\sum_{i=1}^n \frac {\mu(i)} i J(x^{\frac 1 i})$ |
|---|---|---|
| 1 | 5762113.053 | 5762113.053 |
| 2 | -623.549 | 5761489.504 |
| 3 | -32.223 | 5761457.281 |
| 4 | 0 | 5761457.281 |
| 5 | -2.923 | 5761454.358 |
| 6 | 1.597 | 5761455.955 |
| 7 | -1.048 | 5761454.908 |
| 8 | 0 | 5761454.908 |
| 9 | 0 | 5761454.908 |
| 10 | 0.350 | 5761455.258 |
| 11 | -0.318 | 5761454.940 |
| 12 | 0 | 5761454.940 |
| 13 | -0.192 | 5761454.747 |
| 14 | 0.143 | 5761454.890 |
| 15 | 0.133 | 5761455.023 |
| 16 | 0 | 5761455.023 |
| 17 | -0.059 | 5761454.965 |
| 18 | 0 | 5761454.965 |
| 19 | -0.053 | 5761454.912 |
| 20 | 0 | 5761454.912 |
| 21 | 0.048 | 5761454.960 |
| 22 | 0.045 | 5761455.005 |
| 23 | -0.043 | 5761454.962 |
| 24 | 0 | 5761454.962 |
| 25 | 0 | 5761454.962 |
| 26 | 0.038 | 5761455.000 (得到了最终值 $\pi(10e8)$ |
| 27 | 0 | 5761455.000|

$\pi(x) = \sum_{n=1}^\infty \frac {\mu(n)} n J(x^{\frac 1 n})$ 只有有限项，且有内外两重循环，把它展开一个个看，会发现第一项可不就是 π(x) 呗，也就是说该公式全展开后，第一项之外所有项的和是 0。所以用该公式算完后确实得到了 π(x) 的正确值，但其实第一项就偷偷算出它来了。后面的都是无用功装模作样而已。

见[代码](https://github.com/superzhangmch/riemann_zeta_some_scripts/blob/main/prime_count_using_mobius.py)

#### (2). 黎曼 π(x) 公式和上面关系

对比 $\pi(x) = \sum_n \frac {\mu(n)} n J(x^{1/n})$, 其实可以证明，正有这里的 J(..) = 上面的 J(..)，或者说把它们放一起：

$$\begin{cases}
\pi(x) &= Σ_{n=1}^\infty \frac {\mu(n)} n J(x^{1/n})\\
J(x) &= Σ_{n=1}^\infty \frac {π(x^{1/n})} n = \text{Li}(x) - \sum_{Im(\rho)>0} [\text{Li}(x^{\rho}+\text{Li}(x^{1-\rho})] + \int_x^\infty \frac {dt} {t(t^2-1) \ln t} - \ln 2
\end{cases}$$

但要注意：riemann 的 π(x) 若只取有限项，则其实是关于x 的连续函数，若 x 正好是素数，则 π(x-ε) 比 π(x+ε) 会多1，从而 π(x) 取值会是 (π(x-ε)+π(x+ε))/2。这要求 π(x) 在素数点的取值要比实际多 1/2, 或者说令 π₀(x):=(根据x是否素数，取值π(x) 或 π(x)+1/2), 黎曼的素数计数公式其实是在拟合这个 π₀(x)。好在在这样的 π₀(x) 下，上面的莫比乌斯展开依然成立([代码](https://github.com/superzhangmch/riemann_zeta_some_scripts/blob/main/prime_count_using_mobius.py))： $π_0(x) = Σ_{n=1}^\infty \frac {\mu(n)} n J(x^{1/n}), where \ J(x) = Σ_{n=1}^\infty \frac {π_0(x^{1/n})} n$。所以所有提到 π(x) 的地方，其实应该是 π₀(x).

于是为了用基于 zeta(s) 零点的 Riemann 公式算 π(x), 其实也只需作有限项，且这有限项里，除了开头几项，后面的可以直接拿 $J(x) = Σ_{n=1}^\infty \frac {π(x^{1/n})} n$ 精准算出（这些项急速衰减，展开后涉及到的 π(x^..) 值都很小）。

莫比乌斯求和及时截断的黎曼公式实现[代码](https://github.com/superzhangmch/riemann_zeta_some_scripts/blob/main/prime_count_using_riemann's_formula_more.py), 同时支持把且后面项用 $J(x) = Σ_{n=1}^\infty \frac {π(x^{1/n})} n$ 代替。


![image](https://github.com/user-attachments/assets/7a5dc170-ef8d-4512-9535-49f519bd0908)

上面是用1000个零点，算0~20之间的 $\pi(x)$. 可以看到x是素数点的时候，确实是正好加0.5， 或者看数据取值(11附近):
```
# 格式：final x=.. pi(x)=..
final 10.91 4.05953855431767345341642006770
final 10.92 4.02655991632880922043871734252
final 10.93 4.01621566679161013402879426265
final 10.94 4.05364134240102155821970003118
final 10.950000000000001 4.09198809579432206244871397389
final 10.96 4.06269723723855446042369385490
final 10.97 3.98191720048856569216097034726
final 10.98 3.97687469811888973049545511214 # ≈ 4.5
final 10.99 4.17214642872205023461860461143
final 11.0 4.54597763431172957569677638665 # x=11 乃素数点, ≈ 4.5
final 11.01 4.92214452818260576921324313292
final 11.02 5.12126574225224918394538107857 # ≈ 5
final 11.03 5.11605492458871283466779534596
final 11.040000000000001 5.03022809620685664366010637858
final 11.05 4.99622278297851396275403595503
final 11.06 5.03510238988078968973454756156
final 11.07 5.07653668094377145002207183379
final 11.08 5.06734181306185941916468589442
final 11.09 5.03035054090664112658063261497
```

![image](https://github.com/user-attachments/assets/62f7ed1b-fd13-438b-ab72-1e6cb7ff93c9)

上面是用100个零点，算0~20之间的 $\pi(x)$.

