# riemann siegel 公式

$$Z(t) \sim 2 \sum_{k=1}^{\nu(t)} \frac{1}{\sqrt{k}} \cos[\theta(t) - t \ln k] + R(t), \text{where}\ \nu(t) = \left\lfloor \sqrt{\frac{t}{2\pi}} \right\rfloor$$

### θ(t)
----

$$\theta(t) = \arg\left(\Gamma\left(\frac{1}{4} + \frac{it}{2}\right)\right) - \frac{\log \pi}{2} t$$

但是看似简单，辐角是个多值函数，需要取对分支：据 https://en.wikipedia.org/wiki/Riemann%E2%80%93Siegel_theta_function 
> for real values of t. Here the argument is chosen in such a way that a continuous function is obtained and θ(0)=0 holds, i.e., in the same way that the principal branch of the log-gamma function is defined.

一般还是用它的渐进展开。见 https://arxiv.org/pdf/2004.00926 有：

$$\begin{cases}
\theta(t) \sim \frac{1}{2} t (\log (t / 2\pi) - 1) - \frac{\pi}{8} + \sum_{k=1}^{\infty} \frac{(1 - 2^{1-2k})|B_{2k}|}{4k(2k-1)t^{2k-1}} + \frac{1}{2} \arctan(e^{-\pi t}) \\
\arctan(e^{-\pi t}) = e^{-\pi t} - \frac{1}{3} e^{-3\pi t} + \frac{1}{5} e^{-5\pi t} - \frac{1}{7} e^{-7\pi t} + \cdots
\end{cases}$$

对稍大的 t，arctan 项可省， $B_{2k}$ 是伯努利常数，于是展开就可得一般所见之：

$$\theta(t) = -\frac{t}{2} \ln\left(\frac{2\pi}{t}\right) - \frac{t}{2} - \frac{\pi}{8} + \frac{1}{48t} + \frac{7}{5760t^3} + \frac{31}{80640t^5} + \ldots$$

### R(t)
----

见：https://mathworld.wolfram.com/Riemann-SiegelFormula.html

$$
\begin{cases}
\psi(p) &= \frac{\cos\left[2\pi\left(p^2 - p - \frac{1}{16}\right)\right]}{\cos(2\pi p)} \\
c_0(p) &= \psi(p) \\
c_1(p) &= -\frac{\psi^{(3)}(p)}{96 \pi^2} \\
c_2(p) &= \frac{\psi''(p)}{64 \pi^2} + \frac{\psi^{(6)}(p)}{18432 \pi^4} \\
c_3(p) &= -\frac{\psi'(p)}{64 \pi^2} - \frac{\psi^{(5)}(p)}{3840 \pi^4} - \frac{\psi^{(9)}(p)}{5308416 \pi^6} \\
c_4(p) &= \frac{\psi(p)}{128 \pi^2} + \frac{19\psi^{(4)}(p)}{24576 \pi^4} + \frac{11\psi^{(8)}(p)}{5898240 \pi^6} + \frac{\psi^{(12)}(p)}{2038431744 \pi^8} \\
c_5(p) &= -\frac{5\psi^{(3)}(p)}{3072 \pi^4} - \frac{901\psi^{(7)}(p)}{82575360 \pi^6} - \frac{7\psi^{(11)}(p)}{849346560 \pi^8} - \frac{\psi^{(15)}(p)}{978447237120 \pi^{10}} \\
\nu(t) &= \left\lfloor \sqrt{\frac{t}{2\pi}} \right\rfloor \\
R(t) &= (-1)^{\nu(t)-1} \left( \frac{t}{2\pi} \right)^{-1/4} \times \sum_{k=0}^{\infty} c_k \left( \sqrt{\frac{t}{2\pi}} - \nu(t) \right) \left( \frac{t}{2\pi} \right)^{-k/2}
\end{cases}
$$

### Z(t) 与 zeta(s) 关系
----

见 https://mathworld.wolfram.com/Riemann-SiegelFunctions.html 有：

$$Z(t) = e^{i \cdot \theta(t)} \zeta(\frac 1 2 + i \cdot t)$$

从而可用来算 $\zeta(\frac 1 2 + i \cdot t)$.

### 验算
----

python 简单实现后，感受下：

```
t 14.134725142 result (-2.48570234845369e-6, 3.90799447900939e-7 - 2.45478959518499e-6*I) # 对应 Z(t), zeta(1/2 + t*I)
real value (-3.30837177700281e-11 + 2.07813922434745e-10j) # 用库 mpmath.zeta 算出的
--
t 74920.827498994 result (4.00333224209737e-9, 1.17607626555243e-9 - 3.82668442103874e-9*I)
real value (1.21839873343585e-9 - 3.96439209609033e-9j)
--
t 1132490.658714411 result (-5.00254554100521e-9, -1.88569698671789e-9 + 4.633530917574e-9*I)
real value (-1.04376737416186e-9 + 2.56474313160666e-9j)
--
t 10000000001.040558 result (-4.85862765967574e-5, 2.93448189329939e-5 - 3.87234796386691e-5*I)
real value (1.78258821720434e-5 - 2.3523058889941e-5j)
--
t 100000000000.0 result (-0.653629004214943, 0.643124974696211 + 0.116709648585779*I)
real value (0.643663925580119 + 0.116861591461685j)
```

可见还是比较一致的。

R(t) 究竟发挥多大的影响？ 看看只用前k项算 R(t), 以及R(t) 中每项取值多大，对不同数量级的 t 都算下（可见R(t)中各项衰减很快）：

| 不同 t| R(t)用1项 | 用2项 | 第2项=用2项-用1项 | 用3项 | 第3项 | 用4项 | 第4项 | 用5项 | 第5项 |
|----|----|----|----|----|----|----|----|----|----|
| 1|-0.6345044598495415|-0.655517429069081|-0.0210129692195393|-0.707070986729706|-0.0515535576606252|-0.713063998384924|-0.00599301165521826|-0.739579333744351|-0.0265153353594263 |
| 10|0.43515278231361904|0.442419830240922|0.00726704792730304|0.445056454595899|0.00263662435497680|0.460290414631578|0.0152339600356796|2621.77181888558|2621.31152847095 |
| 100|0.44995603821661956|0.453207122848073|0.00325108463145307|0.453244413365569|3.72905174962912e-5|0.453245936533741|1.52316817209064e-6|0.453245937270208|7.36466554407400e-10 |
| 1000|-0.11443535983823791|-0.114301260662533|0.000134099175704810|-0.114310411685205|-9.15102267162737e-6|-0.114310374593537|3.70916678066324e-8|-0.114310379171305|-4.57776773432617e-9 |
| 10000|0.11086319512241483|0.110858071083571|-5.12403884346535e-6|0.110858300609632|2.29526061101826e-7|0.110858300844943|2.35310299023794e-10|0.110858300848712|3.76883246833160e-12 |
| 1000000.0|-0.03974503033274188|-0.0397462061995665|-1.17586682465282e-6|-0.0397462066583713|-4.58804813585623e-10|-0.0397462066585034|-1.32033273203547e-13|-0.0397462066585034|-4.85722573273506e-17 |
| 10000000.0|0.01099153022350783|0.0109914516398405|-7.85836673511398e-8|0.0109914517316597|9.18192067517198e-11|0.0109914517316573|-2.36789754470834e-15|0.0109914517316573|5.20417042793042e-18 |
| 100000000.0|0.006224971809612003|0.00622498803098462|1.62213726140684e-8|0.00622498803614701|5.16239481718195e-12|0.00622498803614706|4.85722573273506e-17|0.00622498803614706|0 |
| 100000000000.0|-0.0011572164500829628|-0.00115721630492646|1.45156506823133e-10|-0.00115721630492737|-9.13331910101789e-16|-0.00115721630492737|0|-0.00115721630492737|0 |
| 10000000000000.0|-0.00043562068661024057|-0.000435620693882526|-7.27228585510609e-12|-0.000435620693882529|-2.60208521396521e-18|-0.000435620693882529|0|-0.000435620693882529|0 |
| 1e+16|-0.00013164570770487317|-0.000131645707646345|5.85284587722307e-14|-0.000131645707646345|0|-0.000131645707646345|0|-0.000131645707646345|0 |
| 1e+21|-6.314820956452297e-06|-6.31482095645260e-6|-3.04084828064294e-19|-6.31482095645260e-6|0|-6.31482095645260e-6|0|-6.31482095645260e-6|0 |
